<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¬Ø´Ù†ÙˆØ§Ø±Ù‡ ÛŒÙ„Ø¯Ø§ÛŒÛŒ Ø§ÛŒØ±Ø§Ù†Ù…Ù‡Ø±</title>
<!-- ÙÙˆÙ†Øª ÙˆØ²ÛŒØ± Ù…ØªÙ† -->
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
<style>
:root {
    --yalda-red: #800020;    /* Ø²Ø±Ø´Ú©ÛŒ ØªÛŒØ±Ù‡ */
    --yalda-green: #013220;  /* Ø³Ø¨Ø² ÛŒØ´Ù…ÛŒ ØªÛŒØ±Ù‡ */
    --yalda-gold: #FFD700;   /* Ø·Ù„Ø§ÛŒÛŒ */
    --yalda-cream: #FFF8E1;
    --glass: rgba(40, 0, 10, 0.4); /* Ø´ÛŒØ´Ù‡ ØªÛŒØ±Ù‡â€ŒØªØ± */
}

html, body {
    height: 100%;
    margin: 0;
    font-family: 'Vazirmatn', sans-serif;
    overflow: hidden;
    direction: rtl;
}

body {
    /* Ú¯Ø±Ø§Ø¯ÛŒÙ†Øª ØªØ±Ú©ÛŒØ¨ÛŒ Ù‚Ø±Ù…Ø² Ùˆ Ø³Ø¨Ø² Ø®ÛŒÙ„ÛŒ ØªÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù‚ */
    background: radial-gradient(circle at 50% 30%, #5c001e 0%, #1a0005 100%);
    color: var(--yalda-cream);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
}

/* Ø§ÙÚ©Øª Ø¯Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø§Ø±/Ø¨Ø±Ù Ø¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ */
.bg-pattern {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background-image: radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px);
    background-size: 30px 30px;
    opacity: 0.3;
    z-index: -2;
}

/* Ú©Ø§Ø±Øª Ø§ØµÙ„ÛŒ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ */
.main-card {
    width: 85%;
    max-width: 1100px;
    /* Ø§Ø±ØªÙØ§Ø¹ Ø±Ø§ Ù…Ù†Ø¹Ø·Ù Ú©Ø±Ø¯ÛŒÙ… ØªØ§ Ù…Ø­ØªÙˆØ§ Ø¬Ø§ Ø´ÙˆØ¯ */
    min-height: 600px; 
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
    border: 1px solid rgba(255, 215, 0, 0.2); /* Ø­Ø§Ø´ÛŒÙ‡ Ø·Ù„Ø§ÛŒÛŒ Ù…Ø­Ùˆ */
    border-radius: 40px;
    padding: 40px 50px;
    text-align: center;
    box-shadow: 0 30px 60px rgba(0,0,0,0.6), inset 0 0 20px rgba(255,215,0,0.05);
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center; /* ÙˆØ³Ø·â€ŒÚ†ÛŒÙ† Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ */
    justify-content: flex-start;
    gap: 20px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ */
}

/* Ù‡Ø¯Ø± */
.header {
    margin-bottom: 10px;
}
.header h1 {
    margin: 0;
    font-size: 3.5rem;
    font-weight: 900;
    color: var(--yalda-gold);
    text-shadow: 0 4px 15px rgba(0,0,0,0.5);
    letter-spacing: -2px;
}
.header h2 {
    font-size: 1.6rem;
    font-weight: 300;
    color: rgba(255, 255, 255, 0.9);
    margin-top: 5px;
}

/* Ø¨Ø®Ø´ QR Ú©Ø¯ - Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ */
.qr-section {
    background: rgba(255, 255, 255, 0.95);
    padding: 15px 20px;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); /* Ø³Ø§ÛŒÙ‡ Ø·Ù„Ø§ÛŒÛŒ */
    text-align: center;
    transition: transform 0.3s;
    border: 2px solid var(--yalda-gold);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
    cursor: pointer; /* Ù†Ø´Ø§Ù†Ú¯Ø± Ù…ÙˆØ³ Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª Ù„ÛŒÙ†Ú© */
    text-decoration: none; /* Ø­Ø°Ù Ø²ÛŒØ±Ø®Ø· Ù„ÛŒÙ†Ú© */
}
.qr-section:hover {
    transform: scale(1.05);
}
.qr-label { 
    color: #800020; 
    font-weight: 800; 
    font-size: 13px; 
    margin-bottom: 8px; 
}
#qrcode img { display: block; margin: 0 auto; }

/* Ø¨Ø§Ú©Ø³ Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ */
.result-display {
    flex-grow: 1;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    margin-top: 10px;
    min-height: 200px;
}

/* Ø­Ø§Ù„Øª Ø§Ù†ØªØ¸Ø§Ø± */
.waiting {
    font-size: 1.8rem;
    color: rgba(255, 255, 255, 0.5);
    animation: breathe 3s infinite ease-in-out;
    border: 2px dashed rgba(255, 215, 0, 0.15);
    padding: 20px 50px;
    border-radius: 20px;
}
@keyframes breathe { 0%, 100%{opacity:0.5; transform:scale(1)} 50%{opacity:0.8; transform:scale(1.02)} }

/* Ø­Ø§Ù„Øª Ø¨Ø±Ù†Ø¯Ù‡ */
.winner-content {
    display: none;
    animation: popUp 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}
@keyframes popUp { 0%{transform:scale(0.5);opacity:0} 100%{transform:scale(1);opacity:1} }

.winner-name {
    font-size: 5rem;
    font-weight: 900;
    background: linear-gradient(to bottom, #fff, #ffeeba);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 0 10px rgba(255,215,0,0.5));
    line-height: 1.1;
    margin-bottom: 20px;
}
.winner-prize {
    font-size: 3rem;
    font-weight: 800;
    color: var(--yalda-green);
    background: var(--yalda-gold);
    padding: 10px 40px;
    border-radius: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    display: inline-block;
    border: 4px solid #fff;
}

.footer {
    position: absolute;
    bottom: 15px;
    width: 100%;
    text-align: center;
    font-size: 0.8rem;
    opacity: 0.5;
    letter-spacing: 3px;
    pointer-events: none;
}
</style>
</head>
<body>

<div class="bg-pattern"></div>

<div class="main-card">
    <div class="header">
        <h1>ğŸ‰ Ø¬Ø´Ù†ÙˆØ§Ø±Ù‡ Ø¨Ø²Ø±Ú¯ ÛŒÙ„Ø¯Ø§</h1>
        <h2>Ú©Ù„ÛŒÙ†ÛŒÚ© ØªØ®ØµØµÛŒ Ø§ÛŒØ±Ø§Ù†Ù…Ù‡Ø±</h2>
    </div>

    <!-- QR Code (Ù„ÛŒÙ†Ú© Ø´Ø¯Ù‡ Ø¨Ù‡ Ø³Ø§ÛŒØª Ø¬Ø¯ÛŒØ¯) -->
    <a href="https://iranmehr2.vercel.app" target="_blank" class="qr-section">
        <div class="qr-label">Ø§Ø³Ú©Ù† Ú©Ù†ÛŒØ¯ Ùˆ Ø¬Ø§ÛŒØ²Ù‡ Ø¨Ú¯ÛŒØ±ÛŒØ¯</div>
        <div id="qrcode"></div>
    </a>

    <div class="result-display">
        <!-- Ø­Ø§Ù„Øª Ø§Ù†ØªØ¸Ø§Ø± -->
        <div class="waiting" id="waitingMsg">
            Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ú†Ø±Ø®Ø´ Ú¯Ø±Ø¯ÙˆÙ†Ù‡...
        </div>

        <!-- Ø­Ø§Ù„Øª Ø¨Ø±Ù†Ø¯Ù‡ -->
        <div class="winner-content" id="winnerContent">
            <div class="winner-name" id="wName"></div>
            <div class="winner-prize" id="wPrize"></div>
        </div>
    </div>
</div>

<div class="footer">IRANMEHR BEAUTY CLINIC</div>

<!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ QR Code Ùˆ Confetti Ùˆ Firebase -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, query, limitToLast, onChildAdded } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC2hX016YUfRGTaJ913oMXCUnaY-IbvLUs",
  authDomain: "iranmehr-6518f.firebaseapp.com",
  databaseURL: "https://iranmehr-6518f-default-rtdb.firebaseio.com",
  projectId: "iranmehr-6518f",
  storageBucket: "iranmehr-6518f.firebasestorage.app",
  messagingSenderId: "171332068534",
  appId: "1:171332068534:web:4391388fbcf4b3e74b3217",
  measurementId: "G-GM9HBHCF6K"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const resultsRef = ref(db, 'results');

// --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª QR Code ---
// Ø¢Ø¯Ø±Ø³ Ù†Ù‡Ø§ÛŒÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¯Ø± Vercel
const spinPageUrl = "https://iranmehr2.vercel.app";

new QRCode(document.getElementById("qrcode"), {
    text: spinPageUrl,
    width: 110,
    height: 110,
    colorDark : "#800020", // Ø±Ù†Ú¯ QR Ú©Ø¯ Ø²Ø±Ø´Ú©ÛŒ
    colorLight : "#ffffff",
    correctLevel : QRCode.CorrectLevel.H
});

// --- Ù„Ø§Ø¬ÛŒÚ© Ù†Ù…Ø§ÛŒØ´ Ø¨Ø±Ù†Ø¯Ù‡ ---
const loadTime = Date.now();
const lastQuery = query(resultsRef, limitToLast(1));
let resetTimer;

onChildAdded(lastQuery, (snap) => {
  const data = snap.val();
  if(!data || !data.time) return;
  if (data.time <= lastDisplayedTime) return;
  lastDisplayedTime = data.time;

  showWinner(data);
});

function showWinner(data) {
  const waitingEl = document.getElementById('waitingMsg');
  const contentEl = document.getElementById('winnerContent');
  
  waitingEl.style.display = 'none';
  contentEl.style.display = 'none';
  
  setTimeout(() => {
    contentEl.style.display = 'block';
    document.getElementById('wName').innerText = data.name;
    document.getElementById('wPrize').innerText = data.prize;
    fireConfetti();
  }, 100);

  clearTimeout(resetTimer);
  resetTimer = setTimeout(() => {
    contentEl.style.display = 'none';
    waitingEl.style.display = 'block';
  }, 20000);
}

function fireConfetti() {
    // Ø§ÙÚ©Øª Ø·Ù„Ø§ÛŒÛŒ Ùˆ Ù‚Ø±Ù…Ø²
    const duration = 3000;
    const end = Date.now() + duration;

    (function frame() {
        confetti({
            particleCount: 5,
            angle: 60,
            spread: 55,
            origin: { x: 0 },
            colors: ['#FFD700', '#D32F2F', '#FFFFFF']
        });
        confetti({
            particleCount: 5,
            angle: 120,
            spread: 55,
            origin: { x: 1 },
            colors: ['#FFD700', '#D32F2F', '#FFFFFF']
        });

        if (Date.now() < end) {
            requestAnimationFrame(frame);
        }
    }());
}
</script>
</body>
</html>