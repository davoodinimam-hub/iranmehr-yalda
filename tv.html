<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¬Ø´Ù†ÙˆØ§Ø±Ù‡ ÛŒÙ„Ø¯Ø§ÛŒÛŒ Ø§ÛŒØ±Ø§Ù†Ù…Ù‡Ø±</title>

<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet"/>

<style>
html,body{
  margin:0;
  height:100%;
  direction:rtl;
  font-family:'Vazirmatn',sans-serif;
  background:radial-gradient(circle at top,#5c001e,#120006);
  color:#fff;
  overflow:hidden;
}
.main{
  height:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:25px;
}
h1{color:#FFD700;font-size:3.2rem;margin:0}
h2{margin:0;font-weight:300}

.qr-section{
  background:#fff;
  padding:18px;
  border-radius:18px;
  cursor:pointer;
  box-shadow:0 0 25px rgba(255,215,0,.6);
}
.qr-label{
  color:#800020;
  font-weight:800;
  font-size:14px;
  margin-bottom:10px;
  text-align:center;
}

#winnerBox{
  margin-top:20px;
  text-align:center;
}
#wName{
  font-size:4.5rem;
  font-weight:900;
  color:#FFD700;
}
#wPrize{
  font-size:2.5rem;
  background:#FFD700;
  color:#013220;
  padding:10px 35px;
  border-radius:20px;
  display:inline-block;
  margin-top:15px;
}

.waiting{
  opacity:.5;
  font-size:1.6rem;
  border:2px dashed rgba(255,215,0,.3);
  padding:15px 40px;
  border-radius:20px;
}

.confetti{
  position:fixed;
  width:10px;
  height:10px;
  top:-10px;
  animation:fall 3s linear forwards;
}
@keyframes fall{
  to{transform:translateY(110vh) rotate(720deg);opacity:0}
}
</style>
</head>

<body>

<div class="main">
  <h1>ğŸ‰ Ø¬Ø´Ù†ÙˆØ§Ø±Ù‡ ÛŒÙ„Ø¯Ø§</h1>
  <h2>Ú©Ù„ÛŒÙ†ÛŒÚ© ØªØ®ØµØµÛŒ Ø§ÛŒØ±Ø§Ù†Ù…Ù‡Ø±</h2>

  <div class="qr-section" onclick="window.open('https://iranmehr2.vercel.app')">
    <div class="qr-label">Ø§Ø³Ú©Ù† Ú©Ù†ÛŒØ¯ Ùˆ Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø±Ø§ Ø¨Ú†Ø±Ø®Ø§Ù†ÛŒØ¯</div>
    <div id="qrcode"></div>
  </div>

  <div id="winnerBox">
    <div class="waiting" id="waiting">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ú†Ø±Ø®Ø´ Ú¯Ø±Ø¯ÙˆÙ†Ù‡â€¦</div>
    <div id="wName"></div>
    <div id="wPrize"></div>
  </div>
</div>

<!-- QR -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  new QRCode(document.getElementById("qrcode"),{
    text:"https://iranmehr2.vercel.app",
    width:140,
    height:140,
    colorDark:"#800020",
    colorLight:"#ffffff",
    correctLevel:QRCode.CorrectLevel.H
  });
});
</script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyC2hX016YUfRGTaJ913oMXCUnaY-IbvLUs",
  authDomain:"iranmehr-6518f.firebaseapp.com",
  databaseURL:"https://iranmehr-6518f-default-rtdb.firebaseio.com",
  projectId:"iranmehr-6518f",
  storageBucket:"iranmehr-6518f.firebasestorage.app",
  messagingSenderId:"171332068534",
  appId:"1:171332068534:web:4391388fbcf4b3e74b3217"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let lastKey=null;

function confetti(){
  for(let i=0;i<80;i++){
    const c=document.createElement("div");
    c.className="confetti";
    c.style.left=Math.random()*100+"vw";
    c.style.background=`hsl(${Math.random()*360},100%,50%)`;
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),3000);
  }
}

function showWinner(data){
  document.getElementById("waiting").style.display="none";
  document.getElementById("wName").innerText=data.name;
  document.getElementById("wPrize").innerText=data.prize;
  confetti();
}

setInterval(()=>{
  db.ref("results").limitToLast(1).once("value",snap=>{
    if(!snap.exists())return;
    snap.forEach(child=>{
      if(child.key!==lastKey){
        lastKey=child.key;
        showWinner(child.val());
      }
    });
  });
},1000);
</script>

</body>
</html>